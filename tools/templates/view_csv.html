{% extends "base.html" %}
{% load cms_tags %}

{% block extra_headers %}
<link rel="stylesheet" type="text/css" href="/static/admin/dt_bootstrap/dataTables.bootstrap.css">
{% endblock %}

{% block js_content %}
<script type="text/javascript" src="/static/admin/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/admin/dt_bootstrap/dataTables.bootstrap.js"></script>
<script type="text/javascript">
$(document).ready(function() {
        $("[data-toggle=popover]").popover({trigger: 'manual', html: true,});
        $("[data-toggle=popover]").hover(function () {
                cid = $(this).html();
                $.ajax({
                    type: 'GET',
                    url: '/compounds/cid_lookup',
                    dataType: 'json',
                    success: function(data) {perm_id = data.id},
                    data: { cid: cid },
                    async: false
                });
                if(perm_id != 'ERROR'){
                        $(this).attr('data-content', '<img src="/compounds/' + perm_id + '/png"/>');
                } else {
                        $(this).attr('data-content', 'Error: cid not in workbench')
                }
                $(this).popover('fixTitle').popover('show');
        }, function() {
                $(this).popover('hide');
        });

        gotoCidLink = function(){
                var cid = $(this).html();
                $.ajax({
                    type: 'GET',
                    url: '/compounds/cid_lookup',
                    dataType: 'json',
                    success: function(data) {perm_id = data.id},
                    data: { cid: cid },
                    async: false
                });
                if(perm_id != 'ERROR'){
                        var cidLink = '/compounds/' + perm_id + '/';
                        window.location.href = cidLink;
                }
        }

        $('.cidLink').click(gotoCidLink);
	
	$('#example').dataTable( {
		"sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
		"sScrollX": "100%",
		"bScrollCollapse": true
         } );
} );
</script>

{% endblock %}

{% block base_content %}
<div class="row-fluid">
	<div class="span12">
		<h2>{{ title|default:"Job Result" }}</h2>
	</div>
</div><!--/row-->

{% if job %}
<div class="row-fluid">
	<div class="span12">
	<table class="table table-bordered table-hover">
	<tbody>
	<tr>
		<th>Job Start Time</th>
		<td>{{ job.start_time }}</td>
	</tr>
	<tr>
		<th>Options</th>
		<td>{{ job.options }}</td>
	</tr>
	<tr>
		<th>Results</th>
		<td><a class="btn" href="download/table{{job.id}}.csv">Download CSV Â»</a></td>
	</tr>
	<tr>
		<th>Next Steps</th>
		<td>To plot a heatmap of these data, start a <a href="/tools/launch_job/Clustering/">clustering job</a> and select this job as input.</td>
	</tr>
	</tbody>
	</table>
	</div>
</div><!--/row-->
{% endif %}

<div class="row-fluid">
	<div class="span12">

	{% if csv %}
	<table class="table table-condensed table-striped table-bordered span12" id="example">
	{% for row in csv %}
		{% if forloop.first %}
			<thead>
			{% for cell in row %}
				<th>{{cell}}</th>
			{% endfor %}
			</thead><tbody>
		{% else %}
			<tr>
			{% for cell in row %}
				<td>{% if forloop.first %}<a data-container="body" data-toggle="popover" data-placement="left" title="{{cell}}" data-content="" class="cidLink">{{cell}}</a>{% else %}{{cell}}{% endif %}</td>
			{% endfor %}
			</tr>
			{% if forloop.last %}
				</tbody>
			{% endif %}
		{% endif %}
	{% endfor %}
	</table>
	{% else %}
	<p>No Results.</p>
	{% endif %}
	</div>
</div><!--/row-->


{% endblock %}
